<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Auth Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 16px;
        }
        button:hover {
            background: #3367d6;
        }
        .debug-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 14px;
        }
        .error {
            color: #d32f2f;
            background: #ffebee;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            color: #388e3c;
            background: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Firebase Authentication Debug</h1>
        
        <div class="debug-info" id="debugInfo">
            Loading debug information...
        </div>
        
        <button onclick="testGoogleSignIn()">Test Google Sign In</button>
        <button onclick="testAppleSignIn()">Test Apple Sign In</button>
        <button onclick="signOut()">Sign Out</button>
        <button onclick="refreshDebugInfo()">Refresh Debug Info</button>
        
        <div id="status"></div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { 
            getAuth, 
            signInWithPopup, 
            signInWithRedirect, 
            getRedirectResult,
            signOut as firebaseSignOut,
            onAuthStateChanged,
            GoogleAuthProvider,
            OAuthProvider
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        // Firebase config
        const firebaseConfig = {      
            apiKey: "AIzaSyDNMeWyOpbPMqKTKL333CBgraW3FAoPyFs",
            authDomain: "trueage-b1941.firebaseapp.com",
            projectId: "trueage-b1941",
            storageBucket: "trueage-b1941.firebasestorage.app",
            messagingSenderId: "465255398940",
            appId: "1:465255398940:web:79eb06edb116e960cd69d9"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const googleProvider = new GoogleAuthProvider();
        const appleProvider = new OAuthProvider('apple.com');

        // Configure providers
        googleProvider.setCustomParameters({
            prompt: 'select_account'
        });

        appleProvider.setCustomParameters({
            locale: 'en'
        });

        // Handle redirect result
        getRedirectResult(auth).then((result) => {
            if (result) {
                console.log('Redirect result:', result);
                showStatus('Sign in successful via redirect!', 'success');
                refreshDebugInfo();
            }
        }).catch((error) => {
            console.error('Redirect error:', error);
            showStatus('Redirect error: ' + error.message, 'error');
        });

        // Listen to auth state changes
        onAuthStateChanged(auth, (user) => {
            console.log('Auth state changed:', user);
            refreshDebugInfo();
        });

        // Global functions
        window.testGoogleSignIn = async () => {
            try {
                showStatus('Attempting Google sign in...', '');
                const result = await signInWithPopup(auth, googleProvider);
                console.log('Google sign in result:', result);
                showStatus('Google sign in successful!', 'success');
            } catch (error) {
                console.error('Google sign in error:', error);
                showStatus('Google sign in error: ' + error.message + ' (Code: ' + error.code + ')', 'error');
            }
        };

        window.testAppleSignIn = async () => {
            try {
                showStatus('Attempting Apple sign in...', '');
                const result = await signInWithPopup(auth, appleProvider);
                console.log('Apple sign in result:', result);
                showStatus('Apple sign in successful!', 'success');
            } catch (error) {
                console.error('Apple sign in error:', error);
                showStatus('Apple sign in error: ' + error.message + ' (Code: ' + error.code + ')', 'error');
            }
        };

        window.signOut = async () => {
            try {
                await firebaseSignOut(auth);
                showStatus('Signed out successfully!', 'success');
            } catch (error) {
                console.error('Sign out error:', error);
                showStatus('Sign out error: ' + error.message, 'error');
            }
        };

        window.refreshDebugInfo = () => {
            const user = auth.currentUser;
            const debugInfo = document.getElementById('debugInfo');
            
            debugInfo.innerHTML = `
                <strong>Current Domain:</strong> ${window.location.hostname}<br>
                <strong>User Agent:</strong> ${navigator.userAgent}<br>
                <strong>Firebase Auth State:</strong> ${user ? 'Signed In' : 'Not Signed In'}<br>
                ${user ? `
                <strong>User ID:</strong> ${user.uid}<br>
                <strong>Email:</strong> ${user.email || 'N/A'}<br>
                <strong>Display Name:</strong> ${user.displayName || 'N/A'}<br>
                <strong>Provider:</strong> ${user.providerData[0]?.providerId || 'N/A'}<br>
                ` : ''}
                <strong>Firebase Config:</strong><br>
                - Project ID: ${firebaseConfig.projectId}<br>
                - Auth Domain: ${firebaseConfig.authDomain}<br>
                - API Key: ${firebaseConfig.apiKey.substring(0, 10)}...<br>
            `;
        };

        window.showStatus = (message, type) => {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="${type}">${message}</div>`;
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 5000);
        };

        // Initial debug info
        refreshDebugInfo();
    </script>
</body>
</html> 